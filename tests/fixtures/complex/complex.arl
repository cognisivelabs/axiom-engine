// RULE: Premium User Eligibility
// 
// DESCRIPTION:
// This rule determines if a user is eligible for a special promotion.
// A user is eligible if:
// 1. They are an ACTIVE user.
// 2. AND (They are a Premium/Platinum member WITH at least one big order > 100).
// 3. OR (All their orders have been successfully delivered).
//
// CONTEXT:
// user: { tier: string, active: bool, orders: { total: int, status: string }[] }

// 1. Extract basic status
let is_active: bool = user.active;
let is_premium: bool = user.tier == "gold" || user.tier == "platinum";

// 2. Analyze order history using Google CEL-style Macros
let has_big_order: bool = user.orders.exists(o, o.total > 100);
let all_delivered: bool = user.orders.all(o, o.status == "delivered");

// 3. Apply Decision Logic
let result: bool = false;

if (!is_active) {
    result = false;
} else {
    // Premium users need a big order, otherwise everyone is eligible if all orders are delivered
    result = (is_premium && has_big_order) || all_delivered;
}

// 4. Return the final eligibility result
result
